-- Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local LocalPlayer = Players.LocalPlayer
local selectedPlayerName = nil

-- Carregar Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/tiololo487/Script/refs/heads/main/library"))()

workspace.FallenPartsDestroyHeight = -math.huge

-- Criar Janela
local Window = Library:MakeWindow({
    Title = "anonymus Hub | Brookhaven",
    SubTitle = "By: silvadev",
    LoadText = "Carregando anonymus Hub...",
    Flags = "anonymushub_Brookhaven",
    Size = UDim2.fromScale(0.55, 0.65)
})

Window:AddMinimizeButton({
    Button = { Image = "rbxassetid://2483186", BackgroundTransparency = 0 },
    Corner = { CornerRadius = UDim.new(35, 1) },
})

-- Criar Tab
local Troll = Window:MakeTab({
    Title = "| Troll",
    Icon = "rbxassetid://15309138473"
})

------------------------------------------------------------------
-- Função para pegar lista de jogadores
------------------------------------------------------------------
local function getPlayerList()
    local playerNames = {}
    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            table.insert(playerNames, player.Name)
        end
    end
    return playerNames
end

------------------------------------------------------------------
-- Dropdown de jogadores
------------------------------------------------------------------
local playerDropdown = Troll:AddDropdown({
    Name = "Select Player",
    Options = getPlayerList(),
    Default = "",
    Callback = function(value)
        selectedPlayerName = value
        print("Selected player:", value)
    end
})

------------------------------------------------------------------
-- Botão atualizar lista
------------------------------------------------------------------
Troll:AddButton({
    Name = "Refresh Player List",
    Callback = function()
        local newList = getPlayerList()
        if playerDropdown.Refresh then
            playerDropdown:Refresh(newList) -- biblioteca suporta Refresh
        elseif playerDropdown.SetOptions then
            playerDropdown:SetOptions(newList)
        end

        if selectedPlayerName and not Players:FindFirstChild(selectedPlayerName) then
            selectedPlayerName = nil
            if playerDropdown.Set then
                playerDropdown:Set("")
            end
        end
    end
})

------------------------------------------------------------------
-- Função Fling Ball
------------------------------------------------------------------
local stopFling = nil

local function FlingBall(target)
    -- Validar alvo
    if not target or target == LocalPlayer then return end
    local tchar = target.Character
    if not tchar then return end
    local troot = tchar:FindFirstChild("HumanoidRootPart")
    local thum = tchar:FindFirstChild("Humanoid")
    if not troot or not thum then return end

    -- Validar jogador local
    local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")
    local hrp = character:WaitForChild("HumanoidRootPart")
    local backpack = LocalPlayer:WaitForChild("Backpack")

    -- Validar objetos no workspace
    local WorkspaceCom = workspace:FindFirstChild("WorkspaceCom")
    local ServerBalls = WorkspaceCom and WorkspaceCom:FindFirstChild("001_SoccerBalls")
    if not WorkspaceCom or not ServerBalls then
        warn("WorkspaceCom ou 001_SoccerBalls não encontrados")
        return
    end

    -- Função para obter a bola
    local function GetBall()
        local ball = backpack:FindFirstChild("SoccerBall")
        if not ball then
            local RE = ReplicatedStorage:FindFirstChild("RE")
            local remote = RE and RE:FindFirstChild("1Too1l")
            if remote and remote:IsA("RemoteFunction") then
                pcall(function()
                    remote:InvokeServer("PickingTools", "SoccerBall")
                end)
            else
                warn("RemoteFunction não encontrado")
                return nil
            end
        end

        -- Espera a bola no backpack
        repeat task.wait() until backpack:FindFirstChild("SoccerBall")
        backpack.SoccerBall.Parent = character

        -- Espera o servidor criar a versão no workspace
        repeat task.wait() until ServerBalls:FindFirstChild("Soccer" .. LocalPlayer.Name)
        character.SoccerBall.Parent = backpack

        return ServerBalls:FindFirstChild("Soccer" .. LocalPlayer.Name)
    end

    local Ball = ServerBalls:FindFirstChild("Soccer" .. LocalPlayer.Name) or GetBall()
    if not Ball then return end

    -- Configurações físicas da bola
    Ball.CanCollide = false
    Ball.Massless = true
    Ball.CustomPhysicalProperties = PhysicalProperties.new(0.0001, 0, 0)

    -- Limpa BodyVelocity antigo
    for _, v in ipairs(Ball:GetChildren()) do
        if v:IsA("BodyVelocity") or v:IsA("BodyPosition") or v:IsA("BodyGyro") then
            v:Destroy()
        end
    end

    -- Cria BodyPosition otimizado
    local bp = Instance.new("BodyPosition")
    bp.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    bp.P = 5e4
    bp.D = 100
    bp.Position = troot.Position
    bp.Parent = Ball

    -- Ajusta câmera para acompanhar o alvo
    local originalCameraSubject = workspace.CurrentCamera.CameraSubject
    workspace.CurrentCamera.CameraSubject = thum

    -- Variáveis de controle
    local direction = 1
    local distance = 6
    local running = true

    -- Função de parada
    stopFling = function()
        running = false
        if bp then
            bp:Destroy()
        end
        workspace.CurrentCamera.CameraSubject = originalCameraSubject
    end

    -- Loop de movimento lateral
    spawn(function()
        while running and tchar:IsDescendantOf(workspace) and thum.Health > 0 do
            direction = direction * -1
            local offset = troot.CFrame.RightVector * (distance * direction)
            bp.Position = troot.Position + offset + Vector3.new(0, 1, 0)
            task.wait(0.3) -- update rápido, mas não sobrecarrega
        end
        stopFling()
    end)
end

------------------------------------------------------------------
-- Toggle Fling Ball
------------------------------------------------------------------
Troll:AddToggle({
    Name = "Fling Ball",
    Default = false,
    Callback = function(state)
        local target = selectedPlayerName and Players:FindFirstChild(selectedPlayerName)
        if state then
            if target then
                print("Fling Ligado")
                spawn(function()
                    FlingBall(target)
                end)
            else
                warn("Selecione um jogador primeiro!")
            end
        else
            if stopFling then
                stopFling()
                stopFling = nil
                print("Fling Desligado")
            end
        end
    end
})